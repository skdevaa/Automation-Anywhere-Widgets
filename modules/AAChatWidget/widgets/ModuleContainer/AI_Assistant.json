{
  "backgroundColor": "{{appsmith.theme.colors.backgroundColor}}",
  "borderColor": "#E0DEDE",
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": "1",
  "bottomRow": 68,
  "boxShadow": "{{appsmith.theme.boxShadow.appBoxShadow}}",
  "defaultModel": "{{ { \n\t\n\tmessage: \"\",\n\tresponse: \"\",\n\temoji : Chat_Controller.config.emoji,\n\t\n\tdata: \nChat_Controller.config.messages,\n\n\ttitle: Chat_Controller.config.title,\n\t\n\tchatId : Chat_Controller.config.chatId,\n\t\n\tprojectId: Chat_Controller.config.projectId,\n\t\n\tagentId: Chat_Controller.config.agentId,\n\n\tapiKey : Chat_Controller.config.apiKey,\n\n\tsecret : Chat_Controller.config.secret,\n\n\tbase: Chat_Controller.config.baseURL,\n\ttextColor: Chat_Controller.config.textColor\n} }}\n\n",
  "dynamicBindingPathList": [
    {
      "key": "theme"
    },
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "defaultModel"
    },
    {
      "key": "backgroundColor"
    }
  ],
  "dynamicHeight": "FIXED",
  "dynamicPropertyPathList": [
    {
      "key": "onSend"
    },
    {
      "key": "onUpload"
    },
    {
      "key": "borderRadius"
    },
    {
      "key": "boxShadow"
    },
    {
      "key": "backgroundColor"
    }
  ],
  "dynamicTriggerPathList": [
    {
      "key": "onResetClick"
    },
    {
      "key": "onSend"
    },
    {
      "key": "onUpload"
    }
  ],
  "events": [
    "onResetClick",
    "onSend",
    "onUpload"
  ],
  "isCanvas": false,
  "isLoading": false,
  "isSearchWildcard": true,
  "isVisible": true,
  "key": "a08ld2wxvo",
  "leftColumn": 0,
  "maxDynamicHeight": 9000,
  "minDynamicHeight": 4,
  "mobileBottomRow": 31,
  "mobileLeftColumn": 39,
  "mobileRightColumn": 62,
  "mobileTopRow": 1,
  "needsErrorInfo": false,
  "onResetClick": "{{showAlert('Successfully reset!!', '');}}",
  "onSend": "{{Chat_Controller.onSend(AI_Assistant.model.message,AI_Assistant.model.response)}}",
  "onUpload": "{{Chat_Controller.onUpload(AI_Assistant.model.message)}}",
  "parentColumnSpace": 19.9375,
  "parentId": "module-canvas-0",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "rightColumn": 64,
  "srcDoc": {
    "css": "@charset \"UTF-8\";\n/* ===== Clean neutral style to match the screenshot ===== */\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\n/* Container */\n.chat-widget-container {\n  display: flex;\n  height: 99vh;\n  flex-direction: column;\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: var(--appsmith-theme-boxShadow);\n  border: 1px solid #efefef;\n  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n  overflow: hidden;\n  overscroll-behavior: contain;\n}\n\n/* Header — minimal, neutral */\n.chat-header {\n  flex: 0 0 auto;\n  padding: 12px 16px;\n  background: #ffffff;\n  color: #0f172a;\n  font-weight: 600;\n  font-size: 14px;\n  border-bottom: 1px solid #f1f5f9;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.chat-header .brand-dot {\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  background: #f59e0b;\n  color: #fff;\n  display: grid;\n  place-items: center;\n  font-size: 12px;\n  font-weight: 700;\n}\n\n.chat-header .brand-title {\n  opacity: 0.85;\n}\n\n/* Messages area */\n.chat-messages {\n  flex: 1 1 auto;\n  min-height: 0;\n  overflow-y: auto;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  overscroll-behavior: contain;\n  -webkit-overflow-scrolling: touch;\n  scroll-behavior: smooth;\n  background: #ffffff;\n}\n\n/* Rows */\n.chat-msg-row {\n  display: flex;\n  align-items: flex-start;\n  width: 100%;\n  gap: 8px;\n}\n\n.chat-msg-row.bot {\n  justify-content: flex-start;\n}\n\n.chat-msg-row.user {\n  justify-content: flex-end;\n}\n\n/* Avatars — small, neutral */\n.chat-avatar {\n  flex-shrink: 0;\n  width: 26px;\n  height: 26px;\n  border-radius: 50%;\n  background: #f3f4f6;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 11px;\n  color: #475569;\n  border: 1px solid #e5e7eb;\n}\n\n/* Bubbles — neutral for both user & bot */\n.chat-msg {\n  max-width: 78%;\n  background: #f7f7f8;\n  color: #111827;\n  border: 1px solid #e5e7eb;\n  padding: 10px 12px;\n  border-radius: 12px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02);\n  font-size: 12px;\n  line-height: 1.5;\n  white-space: pre-wrap;\n  overflow-wrap: anywhere;\n}\n\n.chat-msg.user {\n  background: #f7f7f8;\n}\n\n.chat-msg.bot {\n  background: #f7f7f8;\n}\n\n/* Typing indicator */\n.chat-msg.typing {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  width: auto;\n  background: #f7f7f8;\n}\n\n.dot {\n  width: 6px;\n  height: 6px;\n  border-radius: 50%;\n  background: #6b7280;\n  opacity: 0.35;\n  animation: typing-bounce 1.2s infinite ease-in-out;\n}\n\n.dot:nth-child(2) {\n  animation-delay: 0.15s;\n}\n\n.dot:nth-child(3) {\n  animation-delay: 0.3s;\n}\n\n@keyframes typing-bounce {\n  0%, 80%, 100% {\n    transform: translateY(0);\n    opacity: 0.35;\n  }\n  40% {\n    transform: translateY(-4px);\n    opacity: 0.9;\n  }\n}\n/* Attachments */\n.attachment-line {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  line-height: 1.2;\n}\n\n.file-badge {\n  display: inline-block;\n  padding: 2px 6px;\n  border-radius: 999px;\n  font-size: 10px;\n  font-weight: 800;\n  line-height: 1;\n  letter-spacing: 0.2px;\n  color: #fff;\n}\n\n.file-badge.is-pdf {\n  background: #DC2626;\n}\n\n.file-badge.is-word {\n  background: #2563EB;\n}\n\n.file-badge.is-excel {\n  background: #16A34A;\n}\n\n.file-badge.is-ppt {\n  background: #F97316;\n}\n\n.file-badge.is-img {\n  background: #0EA5E9;\n}\n\n.file-badge.is-zip {\n  background: #6B7280;\n}\n\n.file-badge.is-txt {\n  background: #64748B;\n}\n\n.file-badge.is-code {\n  background: #4F46E5;\n}\n\n.file-badge.is-generic {\n  background: #6B7280;\n}\n\n.attachment-meta {\n  display: flex;\n  align-items: baseline;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n.attachment-name {\n  font-weight: 600;\n  word-break: break-word;\n}\n\n.attachment-size {\n  opacity: 0.8;\n  font-size: 0.9em;\n}\n\n/* Dropzone — neutral border */\n.upload-dropzone {\n  flex: 0 0 auto;\n  border: 1px dashed #e2e8f0;\n  border-radius: 10px;\n  padding: 8px 12px;\n  margin: 8px 12px 0;\n  display: flex;\n  gap: 8px;\n  align-items: center;\n  font-size: 12px;\n  color: #475569;\n  user-select: none;\n  background: #ffffff;\n}\n\n.upload-dropzone.drag {\n  background: #f8fafc;\n  border-color: #cbd5e1;\n}\n\n.upload-dropzone svg {\n  color: #475569;\n}\n\n/* Input area — pill input + circular icon buttons */\n.chat-input-bar {\n  flex: 0 0 auto;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #ffffff;\n  border-top: 1px solid #eef1f7;\n}\n\n/* Circle button (attach) */\n.icon-btn {\n  width: 36px;\n  height: 36px;\n  border-radius: 999px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  display: grid;\n  place-items: center;\n  font-size: 14px;\n  color: #475569;\n  transition: box-shadow 0.15s, border-color 0.15s;\n}\n\n.icon-btn:hover {\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);\n  border-color: #d1d5db;\n}\n\n.icon-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n/* Pill input with embedded send button */\n.input-pill {\n  position: relative;\n  flex: 1;\n  height: 40px;\n  border-radius: 999px;\n  border: 1px solid #e5e7eb;\n  background: #ffffff;\n  display: flex;\n  align-items: center;\n  padding-left: 14px;\n  padding-right: 46px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02);\n}\n\n.input-pill input {\n  width: 100%;\n  border: none;\n  outline: none;\n  background: transparent;\n  font-size: 13px;\n  color: #0f172a;\n}\n\n.input-pill input::placeholder {\n  color: #9aa3af;\n}\n\n/* Send button inside pill, on right */\n.send-btn {\n  position: absolute;\n  right: 6px;\n  top: 50%;\n  transform: translateY(-50%);\n  width: 32px;\n  height: 32px;\n  border-radius: 999px;\n  border: 1px solid #e5e7eb;\n  background: #ffffff;\n  color: #334155;\n  display: grid;\n  place-items: center;\n  font-size: 13px;\n  transition: box-shadow 0.15s, border-color 0.15s, transform 0.08s;\n}\n\n.send-btn:hover {\n  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);\n  border-color: #d1d5db;\n}\n\n.send-btn:active {\n  transform: translateY(-50%) scale(0.98);\n}\n\n.send-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n/* Ensure SVGs inherit text color and align nicely */\n.icon-btn svg, .send-btn svg, .chat-avatar svg, .upload-dropzone svg {\n  display: block;\n}\n\n/* Spinner used inside the attach button while reading */\n.spinner {\n  width: 16px;\n  height: 16px;\n  border: 2px solid #e5e7eb;\n  border-top-color: #475569;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}",
    "html": "<!-- no need to write html, head, body tags, it is handled by the widget -->\n<div id=\"root\"></div>\n",
    "js": "function _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport React from \"https://esm.sh/react@18.2.0\";\nimport ReactDOM from \"https://esm.sh/react-dom@18.2.0\";\nappsmith.events = [{\n  name: \"onSend\",\n  description: \"Triggered when the user sends a message\"\n}, {\n  name: \"onUpload\",\n  description: \"Triggered after user selects files to upload\"\n}];\nconst mockMessages = [{\n  sender: \"bot\",\n  text: \"Hello! I'm your AI Assistant. How can I help you today?\"\n}];\nvar uploadedFile = null;\n\n/* ---------- inline SVG icons (no external fonts) ---------- */\nfunction IconUser(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"1.8\"\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M20 21a8 8 0 0 0-16 0\"\n  }), /*#__PURE__*/React.createElement(\"circle\", {\n    cx: \"12\",\n    cy: \"7\",\n    r: \"4\"\n  }));\n}\nfunction IconSparkles(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"1.8\"\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M12 3l2 4 4 2-4 2-2 4-2-4-4-2 4-2 2-4z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M19 11l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z\"\n  }));\n}\nfunction IconPaperclip(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"1.8\"\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M21.44 11.05l-8.49 8.49a6 6 0 1 1-8.49-8.49l8.49-8.49a4 4 0 1 1 5.66 5.66l-8.49 8.49a2 2 0 1 1-2.83-2.83l7.78-7.78\"\n  }));\n}\nfunction IconSend(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"1.8\"\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M22 2L11 13\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M22 2l-7 20-4-9-9-4 20-7z\"\n  }));\n}\nfunction IconCloudUp(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"16\",\n    height: \"16\",\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: \"currentColor\",\n    \"stroke-width\": \"1.8\"\n  }, props), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M16 16l-4-4-4 4\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M12 12v9\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25\"\n  }));\n}\nfunction Spinner() {\n  return /*#__PURE__*/React.createElement(\"span\", {\n    className: \"spinner\",\n    \"aria-hidden\": \"true\"\n  });\n}\n\n/* ---------- helpers (file badge only; no SVG) ---------- */\nfunction formatBytes(bytes) {\n  if (!bytes) return \"0 B\";\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\", \"TB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const num = bytes / Math.pow(k, i);\n  return `${num.toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`;\n}\nfunction extLabel(ext) {\n  const e = (ext || \"\").toLowerCase();\n  if (e === \"pdf\") return \"PDF\";\n  if ([\"doc\", \"docx\"].includes(e)) return \"DOC\";\n  if ([\"xls\", \"xlsx\", \"csv\"].includes(e)) return \"XLS\";\n  if ([\"ppt\", \"pptx\"].includes(e)) return \"PPT\";\n  if ([\"png\", \"jpg\", \"jpeg\", \"gif\", \"webp\", \"bmp\", \"tiff\", \"svg\"].includes(e)) return \"IMG\";\n  if ([\"zip\", \"rar\", \"7z\", \"tar\", \"gz\", \"bz2\"].includes(e)) return \"ZIP\";\n  if ([\"txt\", \"md\", \"rtf\"].includes(e)) return \"TXT\";\n  if ([\"js\", \"mjs\", \"cjs\", \"ts\", \"tsx\", \"jsx\", \"json\", \"xml\", \"yml\", \"yaml\", \"py\", \"rb\", \"java\", \"c\", \"cpp\", \"cs\", \"go\", \"php\", \"sql\", \"sh\"].includes(e)) return \"CODE\";\n  return (e || \"\").slice(0, 4).toUpperCase() || \"FILE\";\n}\nfunction badgeClassForExt(ext) {\n  const e = (ext || \"\").toLowerCase();\n  if (e === \"pdf\") return \"is-pdf\";\n  if ([\"doc\", \"docx\"].includes(e)) return \"is-word\";\n  if ([\"xls\", \"xlsx\", \"csv\"].includes(e)) return \"is-excel\";\n  if ([\"ppt\", \"pptx\"].includes(e)) return \"is-ppt\";\n  if ([\"png\", \"jpg\", \"jpeg\", \"gif\", \"webp\", \"bmp\", \"tiff\", \"svg\"].includes(e)) return \"is-img\";\n  if ([\"zip\", \"rar\", \"7z\", \"tar\", \"gz\", \"bz2\"].includes(e)) return \"is-zip\";\n  if ([\"txt\", \"md\", \"rtf\"].includes(e)) return \"is-txt\";\n  if ([\"js\", \"mjs\", \"cjs\", \"ts\", \"tsx\", \"jsx\", \"json\", \"xml\", \"yml\", \"yaml\", \"py\", \"rb\", \"java\", \"c\", \"cpp\", \"cs\", \"go\", \"php\", \"sql\", \"sh\"].includes(e)) return \"is-code\";\n  return \"is-generic\";\n}\nfunction FileTypeBadge({\n  ext\n}) {\n  return /*#__PURE__*/React.createElement(\"span\", {\n    className: `file-badge ${badgeClassForExt(ext)}`\n  }, extLabel(ext));\n}\n\n/* -------------- main component -------------- */\nfunction ChatWidget() {\n  const [messages, setMessages] = React.useState(appsmith.model.data || mockMessages);\n  const [input, setInput] = React.useState(\"\");\n  const [isReading, setIsReading] = React.useState(false);\n  const [isThinking, setIsThinking] = React.useState(false);\n  const messagesRef = React.useRef(null);\n  const messagesEndRef = React.useRef(null);\n  const fileInputRef = React.useRef(null);\n  let emojiRef = appsmith.model.emoji;\n\n  // passive watcher memory\n  const prevConfigRef = React.useRef({\n    agentId: appsmith.model.agentId,\n    emoji: appsmith.model.emoji\n  });\n  const isFirstConfigCheck = React.useRef(true);\n  async function handleFilesSelected(fileList) {\n    if (!fileList || fileList.length === 0) return;\n    setIsReading(true);\n    try {\n      const files = Array.from(fileList);\n      const MAX_TOTAL = 10 * 1024 * 1024;\n      const total = files.reduce((sum, f) => sum + (f?.size || 0), 0);\n      if (total > MAX_TOTAL) {\n        const updated = [...messages, {\n          sender: \"bot\",\n          text: \"Total selected file size is over 10 MB. Please upload smaller files.\"\n        }];\n        setMessages(updated);\n        setIsReading(false);\n        return;\n      }\n      const first = files[0];\n      let ensured = first;\n      if (!first.type || !first.type.trim()) {\n        const ext = (first.name.split(\".\").pop() || \"\").toLowerCase();\n        const mimeMap = {\n          pdf: \"application/pdf\",\n          png: \"image/png\",\n          jpg: \"image/jpeg\",\n          jpeg: \"image/jpeg\",\n          gif: \"image/gif\",\n          webp: \"image/webp\",\n          txt: \"text/plain\",\n          csv: \"text/csv\",\n          json: \"application/json\",\n          zip: \"application/zip\",\n          doc: \"application/msword\",\n          docx: \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n          xls: \"application/vnd.ms-excel\",\n          xlsx: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n          ppt: \"application/vnd.ms-powerpoint\",\n          pptx: \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"\n        };\n        const derivedType = mimeMap[ext] || \"application/octet-stream\";\n        ensured = new File([first], first.name, {\n          type: derivedType,\n          lastModified: first.lastModified\n        });\n      }\n      const attachmentLine = files.length === 1 ? `Uploaded: ${ensured.name} (${formatBytes(ensured.size)})` : `Uploaded ${files.length} files.`;\n      const updated = [...messages, {\n        sender: \"user\",\n        text: attachmentLine,\n        attachment: files.length === 1 ? {\n          name: ensured.name,\n          size: ensured.size,\n          prettySize: formatBytes(ensured.size),\n          ext: (ensured.name.split(\".\").pop() || \"\").toLowerCase()\n        } : {\n          name: `${files.length} files`,\n          prettySize: formatBytes(total),\n          ext: \"zip\"\n        }\n      }];\n      setMessages(updated);\n      appsmith.updateModel({\n        message: attachmentLine\n      });\n      uploadedFile = ensured;\n      appsmith.triggerEvent(\"onUpload\", {});\n    } catch (err) {\n      const updated = [...messages, {\n        sender: \"bot\",\n        text: `Upload failed: ${err.message}`\n      }];\n      setMessages(updated);\n    } finally {\n      setIsReading(false);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    }\n  }\n  async function sendMessage(message, file) {\n    const payloadMessage = emojiRef === \"yes\" ? `${message}\\n use emoji in the response` : message;\n    const formdata = new FormData();\n    formdata.append(\"message\", payloadMessage);\n    formdata.append(\"project_id\", appsmith.model.projectId);\n    formdata.append(\"chat_id\", appsmith.model.chatId);\n    formdata.append(\"return_message\", true);\n    formdata.append(\"agent_id\", appsmith.model.agentId);\n    if (file) formdata.append(\"quick_upload_file\", file);\n    const apiHeaders = new Headers({\n      \"X-API-KEY\": appsmith.model.apiKey,\n      \"X-API-SECRET\": appsmith.model.secret\n    });\n    const requestOptions = {\n      method: \"POST\",\n      headers: apiHeaders,\n      body: formdata,\n      redirect: \"follow\"\n    };\n    const endpoint = appsmith.model.base + \"/v2/chat/message\";\n    try {\n      const res = await fetch(endpoint, requestOptions);\n      if (!res.ok) {\n        const errText = await res.text();\n        throw new Error(`HTTP ${res.status}: ${errText}`);\n      }\n      const data = await res.json();\n      return data.message?.response ?? \"\";\n    } catch (err) {\n      console.log(err);\n      return \"Sorry, I couldn't reach the assistant. Please try again.\";\n    } finally {\n      uploadedFile = null;\n    }\n  }\n  function avatar(sender) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"chat-avatar\",\n      title: sender === \"user\" ? \"You\" : \"Assistant\"\n    }, sender === \"user\" ? /*#__PURE__*/React.createElement(IconUser, null) : /*#__PURE__*/React.createElement(IconSparkles, null));\n  }\n  React.useEffect(() => {\n    appsmith.onModelChange((model, prev) => {\n      const newData = model.data || [];\n      const prevData = prev?.data || [];\n      if (JSON.stringify(newData) !== JSON.stringify(prevData)) {\n        setMessages(newData);\n        emojiRef = appsmith.model.emoji;\n        const lastMsg = newData[newData.length - 1];\n        if (lastMsg && lastMsg.sender === \"bot\") setIsThinking(false);\n      }\n    });\n  }, []);\n  React.useEffect(() => {\n    const el = messagesRef.current;\n    if (!el) return;\n    el.scrollTo({\n      top: el.scrollHeight,\n      behavior: \"smooth\"\n    });\n  }, [messages, isThinking]);\n  const handleSend = React.useCallback(async () => {\n    if (!input.trim() || isReading || isThinking) return;\n    setMessages(prev => [...prev, {\n      sender: \"user\",\n      text: input.trim()\n    }]);\n    const toSend = input.trim();\n    setInput(\"\");\n    setIsThinking(true);\n    try {\n      const response = await sendMessage(toSend, uploadedFile);\n      appsmith.updateModel({\n        message: toSend\n      });\n      appsmith.updateModel({\n        response: response\n      });\n      appsmith.triggerEvent(\"onSend\", {});\n    } catch (err) {\n      console.error(err);\n    } finally {\n      setIsThinking(false);\n    }\n  }, [input, isReading, isThinking]);\n  const handleKeyDown = e => {\n    if (e.key === \"Enter\") handleSend();\n  };\n  const onFileInputChange = e => handleFilesSelected(e.target.files);\n  const [dragOver, setDragOver] = React.useState(false);\n  const onDrop = e => {\n    e.preventDefault();\n    setDragOver(false);\n    handleFilesSelected(e.dataTransfer.files);\n  };\n  const onDragOver = e => {\n    e.preventDefault();\n    setDragOver(true);\n  };\n  const onDragLeave = () => setDragOver(false);\n  const stopScrollPropagation = e => {\n    e.stopPropagation();\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-widget-container\"\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-header\"\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"brand-dot\"\n  }, \"A\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"brand-title\"\n  }, appsmith.model.title)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"upload-dropzone\" + (dragOver ? \" drag\" : \"\"),\n    onDrop: onDrop,\n    onDragOver: onDragOver,\n    onDragLeave: onDragLeave,\n    title: \"Drag & drop files here\"\n  }, /*#__PURE__*/React.createElement(IconCloudUp, null), /*#__PURE__*/React.createElement(\"span\", null, dragOver ? \"Drop to upload\" : \"Drag & drop files here\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-messages\",\n    ref: messagesRef,\n    onWheel: stopScrollPropagation,\n    onTouchMove: stopScrollPropagation\n  }, messages.map((msg, idx) => /*#__PURE__*/React.createElement(\"div\", {\n    key: idx,\n    className: `chat-msg-row ${msg.sender === \"user\" ? \"user\" : \"bot\"}`\n  }, msg.sender === \"user\" ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-msg user\"\n  }, (() => {\n    if (msg.attachment) {\n      const ext = (msg.attachment.ext || \"\").toLowerCase();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-line\"\n      }, /*#__PURE__*/React.createElement(FileTypeBadge, {\n        ext: ext\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-meta\"\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-name\"\n      }, msg.attachment.name), msg.attachment.prettySize && /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-size\"\n      }, msg.attachment.prettySize)));\n    }\n    const t = msg.text || \"\";\n    const m = /^Uploaded:\\s*([^(\\n]+)\\s*\\(([^)]+)\\)/i.exec(t);\n    if (m) {\n      const filename = m[1].trim();\n      const size = m[2].trim();\n      const ext = (filename.split(\".\").pop() || \"\").toLowerCase();\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-line\"\n      }, /*#__PURE__*/React.createElement(FileTypeBadge, {\n        ext: ext\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-meta\"\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-name\"\n      }, filename), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"attachment-size\"\n      }, size)));\n    }\n    return t.replaceAll(\"\\\\n\", \"\\n\");\n  })()), avatar(msg.sender)) : /*#__PURE__*/React.createElement(React.Fragment, null, avatar(msg.sender), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-msg bot\"\n  }, (msg.text || \"\").replaceAll(\"\\\\n\", \"\\n\"))))), isThinking && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-msg-row bot\"\n  }, avatar(\"bot\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-msg bot typing\"\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"dot\"\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"dot\"\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"dot\"\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    ref: messagesEndRef\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-input-bar\"\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    ref: fileInputRef,\n    type: \"file\",\n    multiple: true,\n    style: {\n      display: \"none\"\n    },\n    onChange: onFileInputChange\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => fileInputRef.current?.click(),\n    disabled: isReading || isThinking,\n    className: \"icon-btn\",\n    \"aria-label\": \"Attach files\",\n    title: \"Attach files\"\n  }, isReading ? /*#__PURE__*/React.createElement(Spinner, null) : /*#__PURE__*/React.createElement(IconPaperclip, null)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-pill\"\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    placeholder: \"Ask Anything\",\n    value: input,\n    onChange: e => setInput(e.target.value),\n    onKeyDown: handleKeyDown,\n    disabled: isReading || isThinking\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleSend,\n    disabled: isReading || isThinking,\n    className: \"send-btn\",\n    \"aria-label\": \"Send\",\n    title: \"Send\"\n  }, /*#__PURE__*/React.createElement(IconSend, null)))));\n}\nappsmith.onReady(() => {\n  appsmith.updateModel({\n    data: []\n  });\n  ReactDOM.render(/*#__PURE__*/React.createElement(ChatWidget, null), document.getElementById(\"root\"));\n});"
  },
  "theme": "{{appsmith.theme}}",
  "topRow": 0,
  "type": "CUSTOM_WIDGET",
  "uncompiledSrcDoc": {
    "css": "/* ===== Clean neutral style to match the screenshot ===== */\n\nhtml, body { height: 100%; margin: 0; }\n\n/* Container */\n.chat-widget-container {\n  display: flex;\n  height: 99vh;\n  flex-direction: column;\n  background: #ffffff;\n  border-radius: 12px;\n  box-shadow: var(--appsmith-theme-boxShadow);\n  border: 1px solid #efefef;\n  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;\n  overflow: hidden;\n  overscroll-behavior: contain;\n}\n\n/* Header — minimal, neutral */\n.chat-header {\n  flex: 0 0 auto;\n  padding: 12px 16px;\n  background: #ffffff;\n  color: #0f172a;\n  font-weight: 600;\n  font-size: 14px;\n  border-bottom: 1px solid #f1f5f9;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n.chat-header .brand-dot {\n  width: 20px; height: 20px; border-radius: 50%;\n  background: #f59e0b; color: #fff;\n  display: grid; place-items: center; font-size: 12px; font-weight: 700;\n}\n.chat-header .brand-title { opacity: .85; }\n\n/* Messages area */\n.chat-messages {\n  flex: 1 1 auto;\n  min-height: 0;\n  overflow-y: auto;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  overscroll-behavior: contain;\n  -webkit-overflow-scrolling: touch;\n  scroll-behavior: smooth;\n  background: #ffffff;\n}\n\n/* Rows */\n.chat-msg-row { display: flex; align-items: flex-start; width: 100%; gap: 8px; }\n.chat-msg-row.bot  { justify-content: flex-start; }\n.chat-msg-row.user { justify-content: flex-end; }\n\n/* Avatars — small, neutral */\n.chat-avatar {\n  flex-shrink: 0;\n  width: 26px; height: 26px;\n  border-radius: 50%;\n  background: #f3f4f6;\n  display: flex; justify-content: center; align-items: center;\n  font-size: 11px;\n  color: #475569;\n  border: 1px solid #e5e7eb;\n}\n\n/* Bubbles — neutral for both user & bot */\n.chat-msg {\n  max-width: 78%;\n  background: #f7f7f8;\n  color: #111827;\n  border: 1px solid #e5e7eb;\n  padding: 10px 12px;\n  border-radius: 12px;\n  box-shadow: 0 1px 2px rgba(0,0,0,0.02);\n  font-size: 12px;\n  line-height: 1.5;\n  white-space: pre-wrap;\n  overflow-wrap: anywhere;\n}\n.chat-msg.user { background: #f7f7f8; }\n.chat-msg.bot  { background: #f7f7f8; }\n\n/* Typing indicator */\n.chat-msg.typing { display: inline-flex; align-items: center; gap: 6px; width: auto; background: #f7f7f8; }\n.dot { width: 6px; height: 6px; border-radius: 50%; background: #6b7280; opacity: 0.35;\n  animation: typing-bounce 1.2s infinite ease-in-out; }\n.dot:nth-child(2) { animation-delay: 0.15s; }\n.dot:nth-child(3) { animation-delay: 0.3s; }\n@keyframes typing-bounce {\n  0%, 80%, 100% { transform: translateY(0); opacity: 0.35; }\n  40% { transform: translateY(-4px); opacity: 0.9; }\n}\n\n/* Attachments */\n.attachment-line { display: flex; align-items: center; gap: 8px; line-height: 1.2; }\n.file-badge {\n  display: inline-block; padding: 2px 6px; border-radius: 999px;\n  font-size: 10px; font-weight: 800; line-height: 1; letter-spacing: 0.2px; color: #fff;\n}\n.file-badge.is-pdf    { background: #DC2626; }\n.file-badge.is-word   { background: #2563EB; }\n.file-badge.is-excel  { background: #16A34A; }\n.file-badge.is-ppt    { background: #F97316; }\n.file-badge.is-img    { background: #0EA5E9; }\n.file-badge.is-zip    { background: #6B7280; }\n.file-badge.is-txt    { background: #64748B; }\n.file-badge.is-code   { background: #4F46E5; }\n.file-badge.is-generic{ background: #6B7280; }\n\n.attachment-meta { display: flex; align-items: baseline; gap: 8px; flex-wrap: wrap; }\n.attachment-name { font-weight: 600; word-break: break-word; }\n.attachment-size { opacity: 0.8; font-size: 0.9em; }\n\n/* Dropzone — neutral border */\n.upload-dropzone {\n  flex: 0 0 auto;\n  border: 1px dashed #e2e8f0;\n  border-radius: 10px;\n  padding: 8px 12px; margin: 8px 12px 0;\n  display: flex; gap: 8px; align-items: center;\n  font-size: 12px; color: #475569; user-select: none;\n  background: #ffffff;\n}\n.upload-dropzone.drag { background: #f8fafc; border-color: #cbd5e1; }\n.upload-dropzone svg { color:#475569; }\n\n/* Input area — pill input + circular icon buttons */\n.chat-input-bar {\n  flex: 0 0 auto;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 12px;\n  background: #ffffff;\n  border-top: 1px solid #eef1f7;\n}\n\n/* Circle button (attach) */\n.icon-btn {\n  width: 36px; height: 36px;\n  border-radius: 999px;\n  background: #ffffff;\n  border: 1px solid #e5e7eb;\n  display: grid; place-items: center;\n  font-size: 14px; color: #475569;\n  transition: box-shadow .15s, border-color .15s;\n}\n.icon-btn:hover { box-shadow: 0 1px 4px rgba(0,0,0,0.06); border-color: #d1d5db; }\n.icon-btn:disabled { opacity: 0.6; cursor: not-allowed; }\n\n/* Pill input with embedded send button */\n.input-pill {\n  position: relative;\n  flex: 1;\n  height: 40px;\n  border-radius: 999px;\n  border: 1px solid #e5e7eb;\n  background: #ffffff;\n  display: flex; align-items: center;\n  padding-left: 14px; padding-right: 46px;\n  box-shadow: 0 1px 2px rgba(0,0,0,0.02);\n}\n.input-pill input {\n  width: 100%;\n  border: none;\n  outline: none;\n  background: transparent;\n  font-size: 13px;\n  color: #0f172a;\n}\n.input-pill input::placeholder { color: #9aa3af; }\n\n/* Send button inside pill, on right */\n.send-btn {\n  position: absolute;\n  right: 6px; top: 50%; transform: translateY(-50%);\n  width: 32px; height: 32px; border-radius: 999px;\n  border: 1px solid #e5e7eb; background: #ffffff; color: #334155;\n  display: grid; place-items: center; font-size: 13px;\n  transition: box-shadow .15s, border-color .15s, transform .08s;\n}\n.send-btn:hover { box-shadow: 0 1px 4px rgba(0,0,0,0.08); border-color: #d1d5db; }\n.send-btn:active { transform: translateY(-50%) scale(0.98); }\n.send-btn:disabled { opacity: .6; cursor: not-allowed; }\n\n/* Ensure SVGs inherit text color and align nicely */\n.icon-btn svg, .send-btn svg, .chat-avatar svg, .upload-dropzone svg { display:block; }\n\n/* Spinner used inside the attach button while reading */\n.spinner {\n  width: 16px; height: 16px;\n  border: 2px solid #e5e7eb;\n  border-top-color: #475569;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n@keyframes spin { to { transform: rotate(360deg); } }\n",
    "html": "<!-- no need to write html, head, body tags, it is handled by the widget -->\n<div id=\"root\"></div>\n",
    "js": "import React from \"https://esm.sh/react@18.2.0\";\nimport ReactDOM from \"https://esm.sh/react-dom@18.2.0\";\n\nappsmith.events = [\n  { name: \"onSend\", description: \"Triggered when the user sends a message\" },\n  { name: \"onUpload\", description: \"Triggered after user selects files to upload\" },\n];\n\nconst mockMessages = [\n  { sender: \"bot\", text: \"Hello! I'm your AI Assistant. How can I help you today?\" },\n];\n\nvar uploadedFile = null;\n\n/* ---------- inline SVG icons (no external fonts) ---------- */\nfunction IconUser(props){return(<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.8\" {...props}><path d=\"M20 21a8 8 0 0 0-16 0\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/></svg>);}\nfunction IconSparkles(props){return(<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.8\" {...props}><path d=\"M12 3l2 4 4 2-4 2-2 4-2-4-4-2 4-2 2-4z\"/><path d=\"M19 11l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z\"/></svg>);}\nfunction IconPaperclip(props){return(<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.8\" {...props}><path d=\"M21.44 11.05l-8.49 8.49a6 6 0 1 1-8.49-8.49l8.49-8.49a4 4 0 1 1 5.66 5.66l-8.49 8.49a2 2 0 1 1-2.83-2.83l7.78-7.78\"/></svg>);}\nfunction IconSend(props){return(<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.8\" {...props}><path d=\"M22 2L11 13\"/><path d=\"M22 2l-7 20-4-9-9-4 20-7z\"/></svg>);}\nfunction IconCloudUp(props){return(<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.8\" {...props}><path d=\"M16 16l-4-4-4 4\"/><path d=\"M12 12v9\"/><path d=\"M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25\"/></svg>);}\nfunction Spinner(){return(<span className=\"spinner\" aria-hidden=\"true\"></span>);}\n\n/* ---------- helpers (file badge only; no SVG) ---------- */\nfunction formatBytes(bytes) {\n  if (!bytes) return \"0 B\";\n  const k = 1024;\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\", \"TB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const num = bytes / Math.pow(k, i);\n  return `${num.toFixed(i === 0 ? 0 : 1)} ${sizes[i]}`;\n}\n\nfunction extLabel(ext) {\n  const e = (ext || \"\").toLowerCase();\n  if (e === \"pdf\") return \"PDF\";\n  if ([\"doc\",\"docx\"].includes(e)) return \"DOC\";\n  if ([\"xls\",\"xlsx\",\"csv\"].includes(e)) return \"XLS\";\n  if ([\"ppt\",\"pptx\"].includes(e)) return \"PPT\";\n  if ([\"png\",\"jpg\",\"jpeg\",\"gif\",\"webp\",\"bmp\",\"tiff\",\"svg\"].includes(e)) return \"IMG\";\n  if ([\"zip\",\"rar\",\"7z\",\"tar\",\"gz\",\"bz2\"].includes(e)) return \"ZIP\";\n  if ([\"txt\",\"md\",\"rtf\"].includes(e)) return \"TXT\";\n  if ([\"js\",\"mjs\",\"cjs\",\"ts\",\"tsx\",\"jsx\",\"json\",\"xml\",\"yml\",\"yaml\",\"py\",\"rb\",\"java\",\"c\",\"cpp\",\"cs\",\"go\",\"php\",\"sql\",\"sh\"].includes(e)) return \"CODE\";\n  return (e || \"\").slice(0,4).toUpperCase() || \"FILE\";\n}\nfunction badgeClassForExt(ext) {\n  const e = (ext || \"\").toLowerCase();\n  if (e === \"pdf\") return \"is-pdf\";\n  if ([\"doc\",\"docx\"].includes(e)) return \"is-word\";\n  if ([\"xls\",\"xlsx\",\"csv\"].includes(e)) return \"is-excel\";\n  if ([\"ppt\",\"pptx\"].includes(e)) return \"is-ppt\";\n  if ([\"png\",\"jpg\",\"jpeg\",\"gif\",\"webp\",\"bmp\",\"tiff\",\"svg\"].includes(e)) return \"is-img\";\n  if ([\"zip\",\"rar\",\"7z\",\"tar\",\"gz\",\"bz2\"].includes(e)) return \"is-zip\";\n  if ([\"txt\",\"md\",\"rtf\"].includes(e)) return \"is-txt\";\n  if ([\"js\",\"mjs\",\"cjs\",\"ts\",\"tsx\",\"jsx\",\"json\",\"xml\",\"yml\",\"yaml\",\"py\",\"rb\",\"java\",\"c\",\"cpp\",\"cs\",\"go\",\"php\",\"sql\",\"sh\"].includes(e)) return \"is-code\";\n  return \"is-generic\";\n}\nfunction FileTypeBadge({ ext }) {\n  return <span className={`file-badge ${badgeClassForExt(ext)}`}>{extLabel(ext)}</span>;\n}\n\n/* -------------- main component -------------- */\nfunction ChatWidget() {\n  const [messages, setMessages] = React.useState(appsmith.model.data || mockMessages);\n  const [input, setInput] = React.useState(\"\");\n  const [isReading, setIsReading] = React.useState(false);\n  const [isThinking, setIsThinking] = React.useState(false);\n\n  const messagesRef = React.useRef(null);\n  const messagesEndRef = React.useRef(null);\n  const fileInputRef = React.useRef(null);\n\n  let emojiRef = appsmith.model.emoji;\n\n  // passive watcher memory\n  const prevConfigRef = React.useRef({\n    agentId: appsmith.model.agentId,\n    emoji: appsmith.model.emoji,\n  });\n  const isFirstConfigCheck = React.useRef(true);\n\n  async function handleFilesSelected(fileList) {\n    if (!fileList || fileList.length === 0) return;\n    setIsReading(true);\n\n    try {\n      const files = Array.from(fileList);\n      const MAX_TOTAL = 10 * 1024 * 1024;\n      const total = files.reduce((sum, f) => sum + (f?.size || 0), 0);\n      if (total > MAX_TOTAL) {\n        const updated = [\n          ...messages,\n          { sender: \"bot\", text: \"Total selected file size is over 10 MB. Please upload smaller files.\" },\n        ];\n        setMessages(updated);\n        setIsReading(false);\n        return;\n      }\n\n      const first = files[0];\n      let ensured = first;\n      if (!first.type || !first.type.trim()) {\n        const ext = (first.name.split(\".\").pop() || \"\").toLowerCase();\n        const mimeMap = {\n          pdf: \"application/pdf\",\n          png: \"image/png\",\n          jpg: \"image/jpeg\",\n          jpeg: \"image/jpeg\",\n          gif: \"image/gif\",\n          webp: \"image/webp\",\n          txt: \"text/plain\",\n          csv: \"text/csv\",\n          json: \"application/json\",\n          zip: \"application/zip\",\n          doc: \"application/msword\",\n          docx: \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n          xls: \"application/vnd.ms-excel\",\n          xlsx: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n          ppt: \"application/vnd.ms-powerpoint\",\n          pptx: \"application/vnd.openxmlformats-officedocument.presentationml.presentation\",\n        };\n        const derivedType = mimeMap[ext] || \"application/octet-stream\";\n        ensured = new File([first], first.name, {\n          type: derivedType,\n          lastModified: first.lastModified,\n        });\n      }\n\n      const attachmentLine =\n        files.length === 1\n          ? `Uploaded: ${ensured.name} (${formatBytes(ensured.size)})`\n          : `Uploaded ${files.length} files.`;\n\n      const updated = [\n        ...messages,\n        {\n          sender: \"user\",\n          text: attachmentLine,\n          attachment:\n            files.length === 1\n              ? {\n                  name: ensured.name,\n                  size: ensured.size,\n                  prettySize: formatBytes(ensured.size),\n                  ext: (ensured.name.split(\".\").pop() || \"\").toLowerCase(),\n                }\n              : {\n                  name: `${files.length} files`,\n                  prettySize: formatBytes(total),\n                  ext: \"zip\",\n                },\n        },\n      ];\n      setMessages(updated);\n      appsmith.updateModel({ message: attachmentLine });\n      uploadedFile = ensured;\n      appsmith.triggerEvent(\"onUpload\", {});\n    } catch (err) {\n      const updated = [...messages, { sender: \"bot\", text: `Upload failed: ${err.message}` }];\n      setMessages(updated);\n    } finally {\n      setIsReading(false);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    }\n  }\n\n  async function sendMessage(message, file) {\n    const payloadMessage = (emojiRef === \"yes\") ? `${message}\\n use emoji in the response` : message;\n    const formdata = new FormData();\n    formdata.append(\"message\", payloadMessage);\n    formdata.append(\"project_id\", appsmith.model.projectId);\n    formdata.append(\"chat_id\", appsmith.model.chatId);\n    formdata.append(\"return_message\", true);\n    formdata.append(\"agent_id\", appsmith.model.agentId);\n    if (file) formdata.append(\"quick_upload_file\", file);\n\n    const apiHeaders = new Headers({\n      \"X-API-KEY\": appsmith.model.apiKey,\n      \"X-API-SECRET\": appsmith.model.secret\n    });\n\n    const requestOptions = { method: \"POST\", headers: apiHeaders, body: formdata, redirect: \"follow\" };\n    const endpoint = appsmith.model.base + \"/v2/chat/message\";\n\n    try {\n      const res = await fetch(endpoint, requestOptions);\n      if (!res.ok) {\n        const errText = await res.text();\n        throw new Error(`HTTP ${res.status}: ${errText}`);\n      }\n      const data = await res.json();\n      return data.message?.response ?? \"\";\n    } catch (err) {\n      console.log(err);\n      return \"Sorry, I couldn't reach the assistant. Please try again.\";\n    } finally {\n      uploadedFile = null;\n    }\n  }\n\n  function avatar(sender) {\n    return (\n      <div className=\"chat-avatar\" title={sender === \"user\" ? \"You\" : \"Assistant\"}>\n        {sender === \"user\" ? <IconUser/> : <IconSparkles/>}\n      </div>\n    );\n  }\n\n  React.useEffect(() => {\n    appsmith.onModelChange((model, prev) => {\n      const newData = model.data || [];\n      const prevData = prev?.data || [];\n\n      if (JSON.stringify(newData) !== JSON.stringify(prevData)) {\n        setMessages(newData);\n        emojiRef = appsmith.model.emoji;\n\n        const lastMsg = newData[newData.length - 1];\n        if (lastMsg && lastMsg.sender === \"bot\") setIsThinking(false);\n      }\n    });\n  }, []);\n\n  React.useEffect(() => {\n    const el = messagesRef.current;\n    if (!el) return;\n    el.scrollTo({ top: el.scrollHeight, behavior: \"smooth\" });\n  }, [messages, isThinking]);\n\n  const handleSend = React.useCallback(async () => {\n    if (!input.trim() || isReading || isThinking) return;\n\n    setMessages(prev => [...prev, { sender: \"user\", text: input.trim() }]);\n    const toSend = input.trim();\n    setInput(\"\");\n    setIsThinking(true);\n    try {\n      const response = await sendMessage(toSend, uploadedFile);\n      appsmith.updateModel({ message: toSend });\n      appsmith.updateModel({ response: response });\n      appsmith.triggerEvent(\"onSend\", {});\n    } catch (err) {\n      console.error(err);\n    } finally {\n      setIsThinking(false);\n    }\n  }, [input, isReading, isThinking]);\n\n  const handleKeyDown = (e) => {\n    if (e.key === \"Enter\") handleSend();\n  };\n\n  const onFileInputChange = (e) => handleFilesSelected(e.target.files);\n\n  const [dragOver, setDragOver] = React.useState(false);\n  const onDrop = (e) => {\n    e.preventDefault();\n    setDragOver(false);\n    handleFilesSelected(e.dataTransfer.files);\n  };\n  const onDragOver = (e) => { e.preventDefault(); setDragOver(true); };\n  const onDragLeave = () => setDragOver(false);\n\n  const stopScrollPropagation = (e) => { e.stopPropagation(); };\n\n  return (\n    <div className=\"chat-widget-container\">\n      {/* Minimal neutral header */}\n      <div className=\"chat-header\">\n        <span className=\"brand-dot\">A</span>\n        <span className=\"brand-title\">{appsmith.model.title}</span>\n      </div>\n\n      {/* Drag & Drop */}\n      <div\n        className={\"upload-dropzone\" + (dragOver ? \" drag\" : \"\")}\n        onDrop={onDrop}\n        onDragOver={onDragOver}\n        onDragLeave={onDragLeave}\n        title=\"Drag & drop files here\"\n      >\n        <IconCloudUp />\n        <span>{dragOver ? \"Drop to upload\" : \"Drag & drop files here\"}</span>\n      </div>\n\n      {/* Messages */}\n      <div\n        className=\"chat-messages\"\n        ref={messagesRef}\n        onWheel={stopScrollPropagation}\n        onTouchMove={stopScrollPropagation}\n      >\n        {messages.map((msg, idx) => (\n          <div key={idx} className={`chat-msg-row ${msg.sender === \"user\" ? \"user\" : \"bot\"}`}>\n            {msg.sender === \"user\" ? (\n              <>\n                <div className=\"chat-msg user\">\n                  {(() => {\n                    if (msg.attachment) {\n                      const ext = (msg.attachment.ext || \"\").toLowerCase();\n                      return (\n                        <div className=\"attachment-line\">\n                          <FileTypeBadge ext={ext} />\n                          <div className=\"attachment-meta\">\n                            <div className=\"attachment-name\">{msg.attachment.name}</div>\n                            {msg.attachment.prettySize && (\n                              <div className=\"attachment-size\">{msg.attachment.prettySize}</div>\n                            )}\n                          </div>\n                        </div>\n                      );\n                    }\n                    const t = (msg.text || \"\");\n                    const m = /^Uploaded:\\s*([^(\\n]+)\\s*\\(([^)]+)\\)/i.exec(t);\n                    if (m) {\n                      const filename = m[1].trim();\n                      const size = m[2].trim();\n                      const ext = (filename.split(\".\").pop() || \"\").toLowerCase();\n                      return (\n                        <div className=\"attachment-line\">\n                          <FileTypeBadge ext={ext} />\n                          <div className=\"attachment-meta\">\n                            <div className=\"attachment-name\">{filename}</div>\n                            <div className=\"attachment-size\">{size}</div>\n                          </div>\n                        </div>\n                      );\n                    }\n                    return t.replaceAll(\"\\\\n\", \"\\n\");\n                  })()}\n                </div>\n                {avatar(msg.sender)}\n              </>\n            ) : (\n              <>\n                {avatar(msg.sender)}\n                <div className=\"chat-msg bot\">\n                  {(msg.text || \"\").replaceAll(\"\\\\n\", \"\\n\")}\n                </div>\n              </>\n            )}\n          </div>\n        ))}\n\n        {isThinking && (\n          <div className=\"chat-msg-row bot\">\n            {avatar(\"bot\")}\n            <div className=\"chat-msg bot typing\">\n              <span className=\"dot\"></span>\n              <span className=\"dot\"></span>\n              <span className=\"dot\"></span>\n            </div>\n          </div>\n        )}\n        <div ref={messagesEndRef}></div>\n      </div>\n\n      {/* INPUT BAR — pill input + circular icon buttons */}\n      <div className=\"chat-input-bar\">\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          multiple\n          style={{ display: \"none\" }}\n          onChange={onFileInputChange}\n        />\n\n        <button\n          onClick={() => fileInputRef.current?.click()}\n          disabled={isReading || isThinking}\n          className=\"icon-btn\"\n          aria-label=\"Attach files\"\n          title=\"Attach files\"\n        >\n          {isReading ? <Spinner/> : <IconPaperclip/>}\n        </button>\n\n        <div className=\"input-pill\">\n          <input\n            type=\"text\"\n            placeholder=\"Ask Anything\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            onKeyDown={handleKeyDown}\n            disabled={isReading || isThinking}\n          />\n          <button\n            onClick={handleSend}\n            disabled={isReading || isThinking}\n            className=\"send-btn\"\n            aria-label=\"Send\"\n            title=\"Send\"\n          >\n            <IconSend/>\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nappsmith.onReady(() => {\n  appsmith.updateModel({ data: [] });\n  ReactDOM.render(<ChatWidget />, document.getElementById(\"root\"));\n});\n"
  },
  "version": 1,
  "widgetId": "jom6m4lw4y",
  "widgetName": "AI_Assistant"
}